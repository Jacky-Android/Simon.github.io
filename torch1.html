<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/55181594?v=4">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>PytorchåŠ é€Ÿ&nbsp;|&nbsp;Simonâ€™s Blogs</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="PytorchåŠ é€Ÿ">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ”¥&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://avatars.githubusercontent.com/u/55181594?v=4"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="road.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ¤‘&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>2024å¹´æ·±åº¦å­¦ä¹ å­¦ä¹ è·¯çº¿</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ˜€&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About me</span>
        </div>
      </a>
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ”¥&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">PytorchåŠ é€Ÿ</h1>
    
  </header>
  <article id="https://www.notion.so/b9be05da11ba47ca8487f8b8ab75835f" class="PageRoot"><div id="https://www.notion.so/22c15d8c19054db3a32b834e5dfd64ba" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ç”±äºæœ€è¿‘çš„ç¨‹åºå¯¹é€Ÿåº¦è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæƒ³è¦å¿«é€Ÿå‡ºç»“æœï¼Œå› æ­¤ç‰¹åœ°å­¦ä¹ äº†ä¸€ä¸‹æ··åˆç²¾åº¦è¿ç®—å’Œå¹¶è¡ŒåŒ–æ“ä½œï¼Œç”±äºå·²ç»æœ‰å¾ˆå¤šçš„æ–‡ç« ä»‹ç»ç›¸å…³çš„åŸç†ï¼Œå› æ­¤æœ¬ç¯‡åªè®²è¿°å¦‚ä½•åº”ç”¨</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">torch</strong></span><span class="SemanticString">å®ç°æ··åˆç²¾åº¦è¿ç®—ã€æ•°æ®å¹¶è¡Œå’Œåˆ†å¸ƒå¼è¿ç®—ï¼Œä¸å…·ä½“ä»‹ç»åŸç†ã€‚</span></span></p></div><h2 id="https://www.notion.so/8206d0065a8e4f218fecbda0e6905ada" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8206d0065a8e4f218fecbda0e6905ada"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ··åˆç²¾åº¦</strong></span></span></h2><div id="https://www.notion.so/ff26c3bec49542e98146b2ac7f93156b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è‡ªåŠ¨æ··åˆç²¾åº¦è®­ç»ƒï¼ˆauto Mixed Precisionï¼ŒAMPï¼‰å¯ä»¥å¤§å¹…åº¦é™ä½è®­ç»ƒçš„æˆæœ¬å¹¶æé«˜è®­ç»ƒçš„é€Ÿåº¦ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œè‡ªåŠ¨æ··åˆç²¾åº¦è¿ç®—æ˜¯ä½¿ç”¨NVIDIAå¼€å‘çš„Apexå·¥å…·ã€‚ä»PyTorch1.6.0å¼€å§‹ï¼Œ</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">PyTorch</strong></span><span class="SemanticString">å·²ç»è‡ªå¸¦äº†AMPæ¨¡å—ï¼Œå› æ­¤æ¥ä¸‹æ¥ä¸»è¦å¯¹</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">PyTorch</strong></span><span class="SemanticString">è‡ªå¸¦çš„ampæ¨¡å—è¿›è¡Œç®€å•çš„ä½¿ç”¨ä»‹ç»ã€‚</span></span></p></div><pre id="https://www.notion.so/ca6682d349a34c6d9e52ddefe5396088" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">## å¯¼å…¥ampå·¥å…·åŒ…</span>
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>ampimport autocast<span class="token punctuation">,</span> GradScaler

model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">## å¯¹æ¢¯åº¦è¿›è¡Œscaleæ¥åŠ å¿«æ¨¡å‹æ”¶æ•›ï¼Œ</span>
<span class="token comment">## å› ä¸ºfloat16æ¢¯åº¦å®¹æ˜“å‡ºç°underflowï¼ˆæ¢¯åº¦è¿‡å°ï¼‰</span>
scaler <span class="token operator">=</span> GradScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>

batch_size <span class="token operator">=</span> train_loader<span class="token punctuation">.</span>batch_size
num_batches <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span>
end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>images<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token keyword">in</span> tqdm<span class="token punctuation">.</span>tqdm<span class="token punctuation">(</span>
    <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">ascii</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># measure data loading time</span>
    data_time<span class="token punctuation">.</span>update<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> end<span class="token punctuation">)</span>
    optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> args<span class="token punctuation">.</span>gpuisnot <span class="token boolean">None</span><span class="token punctuation">:</span>
        images <span class="token operator">=</span> images<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span>args<span class="token punctuation">.</span>gpu<span class="token punctuation">,</span> non_blocking<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    target <span class="token operator">=</span> target<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span>args<span class="token punctuation">.</span>gpu<span class="token punctuation">,</span> non_blocking<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># è‡ªåŠ¨ä¸ºGPU opé€‰æ‹©ç²¾åº¦æ¥æå‡è®­ç»ƒæ€§èƒ½è€Œä¸é™ä½æ¨¡å‹å‡†ç¡®åº¦</span>
<span class="token keyword">with</span> autocast<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># compute output</span>
        output <span class="token operator">=</span> model<span class="token punctuation">(</span>images<span class="token punctuation">)</span>

        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span>

    scaler<span class="token punctuation">.</span>scale<span class="token punctuation">(</span>loss<span class="token punctuation">)</span><span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># optimizer.step()</span>
    scaler<span class="token punctuation">.</span>step<span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span>
    scaler<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span></span></code></pre><h2 id="https://www.notion.so/25f29d9394684d40a6d784979ff420dd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/25f29d9394684d40a6d784979ff420dd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ•°æ®å¹¶è¡Œ</strong></span></span></h2><div id="https://www.notion.so/257039f2a08449fca8a78c7e03192a3b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å½“æœåŠ¡å™¨æœ‰å•æœºæœ‰å¤šå¡çš„æ—¶å€™ï¼Œä¸ºäº†å®ç°æ¨¡å‹çš„åŠ é€Ÿï¼ˆå¯èƒ½ç”±äºä¸€å¼ GPUä¸å¤Ÿï¼‰ï¼Œå¯ä»¥é‡‡ç”¨å•æœºå¤šå¡å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å¿…é¡»æƒ³åŠæ³•è®©ä¸€ä¸ªæ¨¡å‹å¯ä»¥åˆ†å¸ƒåœ¨å¤šä¸ªGPUä¸Šè¿›è¡Œè®­ç»ƒã€‚</span></span></p></div><div id="https://www.notion.so/3e9091165c6f404b8d02fbb76757bf73" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">PyTorch</strong></span><span class="SemanticString">ä¸­ï¼Œ</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">nn.DataParallel</strong></span><span class="SemanticString">ä¸ºæˆ‘æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œå¯ä»¥å¾ˆç®€å•çš„å®ç°å¯¹æ¨¡å‹çš„å¹¶è¡ŒåŒ–ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">nn.DataParallel</strong></span><span class="SemanticString">å¯¹æ¨¡å‹è¿›è¡ŒåŒ…è£…ï¼Œåœ¨è®¾ç½®ä¸€äº›å‚æ•°ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°æ¨¡å‹çš„å¤šå¡å¹¶è¡Œã€‚</span></span></p></div><pre id="https://www.notion.so/b5586bcfb4274ed48f5e8435262f1930" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># multigpuè¡¨ç¤ºæ˜¾å¡çš„å·ç </span>
multigpu <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span>
<span class="token comment"># è®¾ç½®ä¸»GPU,ç”¨æ¥æ±‡æ€»æ¨¡å‹çš„æŸå¤±å‡½æ•°å¹¶ä¸”æ±‚å¯¼ï¼Œå¯¹æ¢¯åº¦è¿›è¡Œæ›´æ–°</span>
torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>set_device<span class="token punctuation">(</span>args<span class="token punctuation">.</span>multigpu<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># æ¨¡å‹çš„æ¢¯åº¦å…¨éƒ¨æ±‡æ€»åˆ°gpu[0]ä¸Šæ¥</span>
model <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>DataParallel<span class="token punctuation">(</span>model<span class="token punctuation">,</span> device_ids<span class="token operator">=</span>args<span class="token punctuation">.</span>multigpu<span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span>
        args<span class="token punctuation">.</span>multigpu<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
</span></span></span></code></pre><h3 id="https://www.notion.so/7ada091cea0547e3908bfb19b9d1e9a7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7ada091cea0547e3908bfb19b9d1e9a7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">nn.DataParallelä½¿ç”¨æ··åˆç²¾åº¦è¿ç®—</strong></span></span></h3><div id="https://www.notion.so/b109dc8e3c8f4c7d8210817a027fc00a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">nn.DataParallelå¯¹æ¨¡å‹è¿›è¡Œæ··åˆç²¾åº¦è¿ç®—éœ€è¦è¿›è¡Œä¸€äº›ç‰¹æ®Šçš„é…ç½®ï¼Œä¸ç„¶æ¨¡å‹æ˜¯æ— æ³•å®ç°æ•°æ®å¹¶è¡ŒåŒ–çš„ã€‚autocast è®¾è®¡ä¸º â€œthread localâ€ çš„ï¼Œæ‰€ä»¥åªåœ¨ main thread ä¸Šè®¾ autocast åŒºåŸŸæ˜¯ä¸ work çš„ã€‚å€Ÿé‰´è‡ªï¼ˆhttps://zhuanlan.zhihu.com/p/348554267ï¼‰Â è¿™é‡Œå…ˆç»™å‡ºé”™è¯¯çš„æ“ä½œï¼š</span></span></p></div><pre id="https://www.notion.so/8b7b8001daec4fdd865bb795a9b1a629" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>model <span class="token operator">=</span> MyModel<span class="token punctuation">(</span><span class="token punctuation">)</span>
dp_model <span class="token operator">=</span> nn<span class="token punctuation">.</span>DataParallel<span class="token punctuation">(</span>model<span class="token punctuation">)</span>

<span class="token keyword">with</span> autocast<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># dp_model's internal threads won't autocast.</span>
<span class="token comment">#The main thread's autocast state has no effect.</span>
     output <span class="token operator">=</span> dp_model<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token comment"># loss_fn still autocasts, but it's too late...</span>
     loss <span class="token operator">=</span> loss_fn<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
</span></span></span></code></pre><div id="https://www.notion.so/7769672226dc46a9a4c5b7b56a999aeb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è§£å†³çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ï¼š</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">1. åœ¨æ¨¡å‹æ¨¡å—çš„forwardå‡½æ•°ä¸­åŠ å…¥è£…é¥°å‡½æ•°</strong></span></span></p></div><pre id="https://www.notion.so/1720d43ba535431483d4d73b439ca9f1" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>MyModel<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    @autocast<span class="token punctuation">(</span><span class="token punctuation">)</span>
defforward<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span></span></span></code></pre><div id="https://www.notion.so/4ef257fcb55b40a0a0350fdd6ec609b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2. å¦ä¸€ä¸ªæ­£ç¡®å§¿åŠ¿æ˜¯åœ¨ forward çš„é‡Œé¢è®¾ autocast åŒºåŸŸï¼š</strong></span><span class="SemanticString">Â </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">python MyModel(nn.Module): ... def forward(self, input): with autocast(): ...</code></span><span class="SemanticString">Â </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">åœ¨å¯¹forwardå‡½æ•°è¿›è¡Œæ“ä½œåï¼Œå†åœ¨main threadä¸­ä½¿ç”¨autocast</strong></span><span class="SemanticString">Â ```python model = MyModel() dp_model = nn.DataParallel(model)</span></span></p></div><div id="https://www.notion.so/b77e7f9f00804d96982c178d35c26e88" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">with autocast(): output = dp_model(input) loss = loss_fn(output) ```</span></span></p></div><h3 id="https://www.notion.so/dbf6806796974ddb8bbc79e793e40edc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/dbf6806796974ddb8bbc79e793e40edc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">nn.DataParallelç¼ºç‚¹</strong></span></span></h3><div id="https://www.notion.so/ec74bf7c9aed42fbb8cc5df18c7c13ea" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">åœ¨æ¯ä¸ªè®­ç»ƒçš„batchä¸­ï¼Œnn.DataParallelæ¨¡å—ä¼šæŠŠæ‰€æœ‰çš„losså…¨éƒ¨åä¼ åˆ°gpu[0]ä¸Šï¼Œå‡ ä¸ªGçš„æ•°æ®ä¼ è¾“ï¼Œlossçš„è®¡ç®—éƒ½éœ€è¦åœ¨ä¸€å¼ æ˜¾å¡ä¸Šå®Œæˆï¼Œè¿™æ ·å­å¾ˆå®¹æ˜“é€ æˆæ˜¾å¡çš„è´Ÿè½½ä¸å‡åŒ€ï¼Œç»å¸¸å¯ä»¥çœ‹åˆ°gpu[0]çš„è´Ÿè½½ä¼šæ˜æ˜¾æ¯”å…¶ä»–çš„gpué«˜å¾ˆå¤šã€‚æ­¤å¤–ï¼Œæ˜¾å¡çš„æ•°æ®ä¼ è¾“é€Ÿåº¦ä¼šå¯¹æ¨¡å‹çš„è®­ç»ƒé€Ÿåº¦é€ æˆå¾ˆå¤§çš„ç“¶é¢ˆï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚å› æ­¤æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»‹ç»ï¼Œå…·ä½“åŸç†å¯ä»¥å‚è€ƒå•æœºå¤šå¡æ“ä½œ(åˆ†å¸ƒå¼DataParallelï¼Œæ··åˆç²¾åº¦ï¼ŒHorovod)ï¼ˆhttps://zhuanlan.zhihu.com/p/158375055ï¼‰</span></span></p></div><h2 id="https://www.notion.so/2b9d5aea99054992b7e35c2d60ae9821" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/2b9d5aea99054992b7e35c2d60ae9821"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">åˆ†å¸ƒå¼è¿ç®—</strong></span></span></h2><div id="https://www.notion.so/3c29d8e32e08437d94cee288597d4fff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">nn.DistributedDataParallelï¼šå¤šè¿›ç¨‹æ§åˆ¶å¤š GPUï¼Œä¸€èµ·è®­ç»ƒæ¨¡å‹ã€‚</span></span></p></div><h3 id="https://www.notion.so/58ae8bad0e85462e991f55dcd20c8cf9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/58ae8bad0e85462e991f55dcd20c8cf9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">ä¼˜ç‚¹</strong></span></span></h3><div id="https://www.notion.so/698ba12facc5411898eafb67c0db2185" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">æ¯ä¸ªè¿›ç¨‹æ§åˆ¶ä¸€å—GPUï¼Œå¯ä»¥ä¿è¯æ¨¡å‹çš„è¿ç®—å¯ä»¥ä¸å—åˆ°æ˜¾å¡ä¹‹é—´é€šä¿¡çš„å½±å“ï¼Œå¹¶ä¸”å¯ä»¥ä½¿å¾—æ¯å¼ æ˜¾å¡çš„è´Ÿè½½ç›¸å¯¹æ¯”è¾ƒå‡åŒ€ã€‚ä½†æ˜¯ç›¸å¯¹äºå•æœºå•å¡æˆ–è€…å•æœºå¤šå¡(nn.DataParallelï¼‰æ¥è¯´ï¼Œå°±æœ‰å‡ ä¸ªé—®é¢˜</span></span></p></div><div id="https://www.notion.so/4a24714398de45d59c2df8fb75982c83" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">1. åŒæ­¥ä¸åŒGPUä¸Šçš„æ¨¡å‹å‚æ•°ï¼Œç‰¹åˆ«æ˜¯BatchNormalization</strong></span><span class="SemanticString">Â </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">2. å‘Šè¯‰æ¯ä¸ªè¿›ç¨‹è‡ªå·±çš„ä½ç½®ï¼Œä½¿ç”¨å“ªå—GPUï¼Œç”¨args.local_rankå‚æ•°æŒ‡å®š</strong></span><span class="SemanticString">Â </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">3. æ¯ä¸ªè¿›ç¨‹åœ¨å–æ•°æ®çš„æ—¶å€™è¦ç¡®ä¿æ‹¿åˆ°çš„æ˜¯ä¸åŒçš„æ•°æ®ï¼ˆDistributedSamplerï¼‰</strong></span></span></p></div><h3 id="https://www.notion.so/551e260b7f7d4bd6828e40e0255885b7" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/551e260b7f7d4bd6828e40e0255885b7"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">ä½¿ç”¨æ–¹å¼ä»‹ç»</strong></span></span></h3><div id="https://www.notion.so/d1cf5819242446e2be8e3694406579b5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">å¯åŠ¨ç¨‹åº</strong></span><span class="SemanticString">Â ç”±äºåšä¸»ç›®å‰ä¹Ÿåªæ˜¯å®è·µäº†å•æœºå¤šå¡æ“ä½œï¼Œå› æ­¤ä¸»è¦å¯¹å•æœºå¤šå¡è¿›è¡Œä»‹ç»ã€‚åŒºåˆ«äºå¹³æ—¶ç®€å•çš„è¿è¡Œpythonç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨PyTorchè‡ªå¸¦çš„å¯åŠ¨å™¨ torch.distributed.launch æ¥å¯åŠ¨ç¨‹åºã€‚</span></span></p></div><pre id="https://www.notion.so/530b9f348e334ffaa6fa1a29016e6510" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># å…¶ä¸­CUDA_VISIBLE_DEVICESæŒ‡å®šæœºå™¨ä¸Šæ˜¾å¡çš„æ•°é‡</span>
<span class="token comment"># nproc_per_nodeç¨‹åºè¿›ç¨‹çš„æ•°é‡</span>
CUDA_VISIBLE_DEVICES<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> python <span class="token operator">-</span>m torch<span class="token punctuation">.</span>distributed<span class="token punctuation">.</span>launch <span class="token operator">-</span><span class="token operator">-</span>nproc_per_node<span class="token operator">=</span><span class="token number">4</span> main<span class="token punctuation">.</span>py
</span></span></span></code></pre><div id="https://www.notion.so/01b8ecdac52446adb2dc851b805442c6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">é…ç½®ä¸»ç¨‹åº</strong></span></span></p></div><pre id="https://www.notion.so/e989d73fc67b4108980b947794886cde" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--local_rank'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span>ï¼Œ<span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'node rank for distributed training'</span><span class="token punctuation">)</span>
<span class="token comment"># é…ç½®local_rankå‚æ•°ï¼Œå‘Šè¯‰æ¯ä¸ªè¿›ç¨‹è‡ªå·±çš„ä½ç½®ï¼Œè¦ä½¿ç”¨å“ªå¼ GPU</span>
</span></span></span></code></pre><div id="https://www.notion.so/203416f412824dc293dc6c057e1b188e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">åˆå§‹åŒ–æ˜¾å¡é€šä¿¡å’Œå‚æ•°è·å–çš„æ–¹å¼</strong></span></span></p></div><pre id="https://www.notion.so/756b9c1281b44736b805bcce0611dc94" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment"># ä¸ºè¿™ä¸ªè¿›ç¨‹æŒ‡å®šGPU</span>
torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>set_device<span class="token punctuation">(</span>args<span class="token punctuation">.</span>local_rank<span class="token punctuation">)</span>
<span class="token comment"># åˆå§‹åŒ–GPUé€šä¿¡æ–¹å¼NCLLå’Œå‚æ•°çš„è·å–æ–¹å¼ï¼Œå…¶ä¸­envè¡¨ç¤ºç¯å¢ƒå˜é‡</span>
<span class="token comment"># PyTorchå®ç°åˆ†å¸ƒå¼è¿ç®—æ˜¯é€šè¿‡NCLLè¿›è¡Œæ˜¾å¡é€šä¿¡çš„</span>
torch<span class="token punctuation">.</span>distributed<span class="token punctuation">.</span>init_process_group<span class="token punctuation">(</span>
    backend<span class="token operator">=</span><span class="token string">'nccl'</span><span class="token punctuation">,</span>
    rank<span class="token operator">=</span>args<span class="token punctuation">.</span>local_rank
<span class="token punctuation">)</span>
</span></span></span></code></pre><div id="https://www.notion.so/5bb6a224eac743c68b11baa506d402a1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">é‡æ–°é…ç½®DataLoader</strong></span></span></p></div><pre id="https://www.notion.so/d9f55e6cb850490e8f577be390258774" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>kwargs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"num_workers"</span><span class="token punctuation">:</span> args<span class="token punctuation">.</span>workers<span class="token punctuation">,</span> <span class="token string">"pin_memory"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token keyword">if</span> use_cudaelse <span class="token punctuation">{</span><span class="token punctuation">}</span>

train_sampler <span class="token operator">=</span> DistributedSampler<span class="token punctuation">(</span>train_dataset<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>train_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>
            train_dataset<span class="token punctuation">,</span>
            batch_size<span class="token operator">=</span>args<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span>
            sampler<span class="token operator">=</span>train_sampler<span class="token punctuation">,</span>
            <span class="token operator">**</span>kwargs
        <span class="token punctuation">)</span>

<span class="token comment"># æ³¨æ„ï¼Œç”±äºä½¿ç”¨äº†Sampleræ–¹æ³•ï¼Œdataloaderä¸­å°±ä¸èƒ½åŠ shuffleã€drop_lastç­‰å‚æ•°äº†</span>
<span class="token triple-quoted-string string">'''
PyTorch dataloader.py 192-197 ä»£ç 
        if batch_sampler is not None:
            # auto_collation with custom batch_sampler
            if batch_size != 1 or shuffle or sampler is not None or drop_last:
                raise ValueError('batch_sampler option is mutually exclusive '
                                 'with batch_size, shuffle, sampler, and '
                                 'drop_last')'''</span>

</span></span></span></code></pre><div id="https://www.notion.so/0feeea4755894b4c831706ba513a6b59" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">pin_memoryå°±æ˜¯é”é¡µå†…å­˜ï¼Œåˆ›å»ºDataLoaderæ—¶ï¼Œè®¾ç½®pin_memory=Trueï¼Œåˆ™æ„å‘³ç€ç”Ÿæˆçš„Tensoræ•°æ®æœ€å¼€å§‹æ˜¯å±äºå†…å­˜ä¸­çš„é”é¡µå†…å­˜ï¼Œè¿™æ ·å°†å†…å­˜çš„Tensorè½¬ä¹‰åˆ°GPUçš„æ˜¾å­˜å°±ä¼šæ›´å¿«ä¸€äº›ã€‚</span></span></p></div><div id="https://www.notion.so/27d0831352f446c2a80d18269a60be58" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ¨¡å‹çš„åˆå§‹åŒ–</strong></span></span></p></div><pre id="https://www.notion.so/42c2824b91154a37a91a28f9da688ae0" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>torch.cuda.set_device(args.local_rank)
deviceÂ =Â torch.device(&#x27;cuda&#x27;,Â args.local_rank)
model.to(device)
modelÂ =Â torch.nn.SyncBatchNorm.convert_sync_batchnorm(model)
modelÂ =Â torch.nn.parallel.DistributedDataParallel(
Â Â Â Â Â Â Â Â model,
Â Â Â Â Â Â Â Â device_ids=[args.local_rank],
Â Â Â Â Â Â Â Â output_device=args.local_rank,
Â Â Â Â Â Â Â Â find_unused_parameters=True,
Â Â Â Â Â Â Â Â )
torch.backends.cudnn.benchmark=True
#Â å°†ä¼šè®©ç¨‹åºåœ¨å¼€å§‹æ—¶èŠ±è´¹ä¸€ç‚¹é¢å¤–æ—¶é—´ï¼Œä¸ºæ•´ä¸ªç½‘ç»œçš„æ¯ä¸ªå·ç§¯å±‚æœç´¢æœ€é€‚åˆå®ƒçš„å·ç§¯å®ç°ç®—æ³•ï¼Œè¿›è€Œå®ç°ç½‘ç»œçš„åŠ é€Ÿ
#Â DistributedDataParallelå¯ä»¥å°†ä¸åŒGPUä¸Šæ±‚å¾—çš„æ¢¯åº¦è¿›è¡Œæ±‡æ€»ï¼Œå®ç°å¯¹æ¨¡å‹GPUçš„æ›´æ–°
</span></span></span></code></pre><div id="https://www.notion.so/fb8beb577ad048b380d415e7fe72a6a1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">DistributedDataParallelå¯ä»¥å°†ä¸åŒGPUä¸Šæ±‚å¾—çš„æ¢¯åº¦è¿›è¡Œæ±‡æ€»ï¼Œå®ç°å¯¹æ¨¡å‹GPUçš„æ›´æ–°</span></span></p></div><h3 id="https://www.notion.so/a4dda1ec28884480b204908dff682b57" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/a4dda1ec28884480b204908dff682b57"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">åŒæ­¥BatchNormalizationå±‚</strong></span></span></h3><div id="https://www.notion.so/e10bc6b619fe41ba94094a6fdad69205" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¯¹äºæ¯”è¾ƒæ¶ˆè€—æ˜¾å­˜çš„è®­ç»ƒä»»åŠ¡æ—¶ï¼Œå¾€å¾€å•å¡ä¸Šçš„ç›¸å¯¹æ‰¹é‡è¿‡å°ï¼Œå½±å“æ¨¡å‹çš„æ”¶æ•›æ•ˆæœã€‚è·¨å¡åŒæ­¥ Batch Normalization å¯ä»¥ä½¿ç”¨å…¨å±€çš„æ ·æœ¬è¿›è¡Œå½’ä¸€åŒ–ï¼Œè¿™æ ·ç›¸å½“äºâ€˜å¢å¤§â€˜äº†æ‰¹é‡å¤§å°ï¼Œè¿™æ ·è®­ç»ƒæ•ˆæœä¸å†å—åˆ°ä½¿ç”¨ GPU æ•°é‡çš„å½±å“ã€‚å‚è€ƒè‡ªå•æœºå¤šå¡æ“ä½œ(åˆ†å¸ƒå¼DataParallelï¼Œæ··åˆç²¾åº¦ï¼ŒHorovod) å¹¸è¿çš„æ˜¯ï¼Œåœ¨è¿‘æœŸçš„Pytorchç‰ˆæœ¬ä¸­ï¼ŒPyTorchå·²ç»å¼€å§‹åŸç”Ÿæ”¯æŒBatchNormalizationå±‚çš„åŒæ­¥ã€‚</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/94ed98c72ffa44e1ba9392095c5cd498" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">torch.nn.SyncBatchNorm</strong></span></span></li><li id="https://www.notion.so/d40b92a6773f4e08aa1f11d7de5f5969" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">torch.nn.SyncBatchNorm.convert_sync_batchnorm</strong></span><span class="SemanticString">ï¼šå°†BatchNorm-alizationå±‚è‡ªåŠ¨è½¬åŒ–ä¸º</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">torch.nn.SyncBatchNorm</strong></span><span class="SemanticString">å®ç°ä¸åŒGPUä¸Šçš„BatchNormalizationå±‚çš„åŒæ­¥</span></span></li></ul><div id="https://www.notion.so/02577654d60a4daf97484d483d4dc675" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å…·ä½“å®ç°è¯·å‚è€ƒæ¨¡å‹çš„åˆå§‹åŒ–éƒ¨åˆ†ä»£ç Â </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">python model = torch.nn.SyncBatchNorm.convert_sync_batchnorm(model)</code></span></span></p></div><div id="https://www.notion.so/73d405b5faa4490f8f87891f5bedd27f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">åŒæ­¥æ¨¡å‹åˆå§‹åŒ–çš„éšæœºç§å­</strong></span></span></p></div><div id="https://www.notion.so/a989c7e1b6e0480f927d92899ffc6e4d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ç›®å‰è¿˜æ²¡æœ‰å°è¯•è¿‡ä¸åŒè¿›ç¨‹ä¸Šä½¿ç”¨ä¸åŒéšæœºç§å­çš„çŠ¶å†µã€‚ä¸ºäº†ä¿é™©èµ·è§ï¼Œå»ºè®®ç¡®ä¿æ¯ä¸ªæ¨¡å‹åˆå§‹åŒ–çš„éšæœºç§å­ç›¸åŒï¼Œä¿è¯æ¯ä¸ªGPUè¿›ç¨‹ä¸Šçš„æ¨¡å‹æ˜¯åŒæ­¥çš„ã€‚</span></span></p></div></article>
  <footer class="Footer">
  <div>&copy; Simonâ€™s Blogs 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>